{% extends 'base.html.twig' %}

{% block title %}Le Blog {{ publication.title|capitalize }} {% endblock %}

{% block body %}
    <section class="bg-blue2 w-full">
        <div class="flex justify-center">
            <div class="w-5/6 border border-blue1 px-40 py-10 bg-white mt-10">
                <!-- Thème et catégorie de la publication  -->
                <div class="flex">
                    <div class="w-1/2 flex justify-start text-2xl font-semibold text-blue1">
                        {{ publication.theme.name|capitalize }}
                    </div>
                    <div class="w-1/2 flex justify-end text-2xl font-semibold text-blue1">
                        {{ publication.category.title|capitalize }}
                    </div>
                </div>
                <div class="mx-auto h-px w-5/6 bg-blue1 mt-10"></div>
                <!-- Images de la publication -->
                <div class="flex justify-center w-full mt-10">
                    <div class="flex justify-center w-full">
                        <label class="w-full flex justify-center" for="publication">
                            {% for item in publication.publicationIncludeImages %}
                                <img class="w-7/12 border border-blue1" src="{{ asset('uploads/ressource/images/'~item.image.name) }}" alt="Ressource(s) cover"/>
                            {% endfor %}
                        </label>
                    </div>
                </div>
                <!-- Titre de la publication -->
                <div>
                    <div class="mt-8 text-center text-5xl font-extrabold text-blue1">
                        {{ publication.title|capitalize }}
                        <div class="mx-auto h-px w-1/3 bg-blue1 mt-8"></div>
                    </div>
                    <!-- Likes & Vues de la publication -->
                    <div class="flex justify-center px-10 mt-4 text-blue1 text-xl font-bold">
                        <p class="my-auto mr-3">Nombre de vues :</p>
                        <i class="my-auto fas fa-eye pt-1">{{ publication.viewNumber }}</i>
                    </div>
                </div>
                <!-- Description de la publication -->
                <div class="mb-20">
                    <div class="mt-8 text-center text-base font-medium">
                        {{ publication.description|capitalize }}
                    </div>
                </div>
                <!--Auteur -->
                <div class="flex w-full items-center p-6 font-sans border border-blue1 rounded-2xl shadow-lg">
                    {% if publication.createdBy.ProfilePicture %}
                        <img
                            src="{{ asset('uploads/user/avatar/' ~ publication.createdBy.ProfilePicture) }}" alt="{{ publication.createdBy.username }}"
                            class="w-10 h-10 rounded-full overflow-hidden"
                        />
                    {% else %}
                        <img
                            src="{{ asset('assets/media/img/user.svg') }}" alt="Avatar de {{ publication.createdBy.username }}"
                            class="w-10 h-10 rounded-full overflow-hidden"
                        />
                    {% endif %}
                    <div class="px-3 flex-1">
                        <p class="text-base font-bold text-base md:text-xl leading-none">{{ publication.createdBy.username }}</p>
                        <p class="text-gray-600 text-xs md:text-base">Ce blog a été créé le {{ publication.createdAt|date('d-m-Y')}}
                    </div>
                    <div class="justify-end">
                        <a href="{{ path('profile_view', {'username': publication.createdBy.username }) }}" class="bg-transparent border border-main-blue dark:border-white text-xs text-main-blue hover:bg-main-blue hover:text-main-white font-bold py-2 px-4 rounded-full">Voir le profil</a>
                    </div>
                    {% if app.user %}
                        <div class="justify-end">
                            <a href="{{ path('user_can_ban_user', {'idUser': publication.createdBy.id }) }}" class="bg-transparent border border-main-blue dark:border-white text-xs text-main-blue hover:bg-main-blue hover:text-main-white font-bold py-2 px-4 rounded-full">
                                <i class="fas fa-flag"></i>
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Commentaires -->
        {% if app.user %}
            <div class="w-5/6 border-l border-b border-r border-blue1 shadow-lg px-40 py-10 bg-white mx-auto">
                <div class="mb-4">
                    <h1 class="text-xl text-blue1">Espace commentaire :</h1>
                </div>
                {{ form_start(commentForm) }}
                <div class="flex justify-start">
                    <div class="w-1/2 mb-1">
                        {{ form_row(commentForm.title) }}
                    </div>
                </div>
                <div class="flex justify-start">
                    <div class="w-full mb-1">
                        {{ form_row(commentForm.content) }}
                    </div>
                </div>
                <div class="flex w-full">
                    <div class="w-2/3">
                    </div>
                    <div class="w-1/3 flex justify-end">
                        {{ form_row(commentForm.submit) }}
                        <button class='w-1/3 px-2 py-1 tracking-wide text-white transition-colors duration-200 bg-blue1 rounded-md'>Annuler</button>
                    </div>
                </div>
                {{ form_end(commentForm) }}
                <div class="mx-auto h-px w-2/3 bg-blue1 mt-8 mb-8"></div>
                {% for comment in comments %}
                    {% if comment.comment.reportedStatus == false %}
                        <div class="w-1/2">
                            <div class="bg-white border border-gray-200 rounded-md px-4 py-2 mt-2 text-blue1 font-bold flex">
                                {% if comment.comment.userEditComments[0].user.ProfilePicture %}
                                    <div class="rounded-full mr-4" style="height: 20px; width: 20px;">
                                        <img src="{{ asset('uploads/user/avatar/' ~ comment.comment.userEditComments[0].user.ProfilePicture) }}" alt="Avatar de {{ comment.comment.userEditComments[0].user.username }}" class="rounded-full shadow-lg mr-4" style="height: 20px; width: 20px;"/>
                                    </div>
                                {% else %}
                                    <div class="rounded-full mr-4" style="height: 20px; width: 20px;">
                                        <img src="{{ asset('assets/media/img/user.svg') }}" alt="Avatar de {{ comment.comment.userEditComments[0].user.username }}"  class="rounded-full shadow-lg mr-4" style="height: 20px; width: 20px;"/>
                                    </div>
                                {% endif %}
                                <a href="{{ path('profile_view', {'username': comment.comment.userEditComments[0].user.username }) }}" >
                                    {{comment.comment.userEditComments[0].user.username}} 
                                </a>
                                <p class="ml-2">
                                    à rédigé(e)
                                </p> 
                                <p class="ml-2">
                                    {{ comment.comment.title }}
                                </p>
                            </div>
                        </div>
                        <div class="w-full">
                            <div class="bg-white border border-gray-200 rounded-md px-4 py-2 mt-2">
                                {{ comment.comment.content }}
                                <div class="w-2/5 mt-2 flex">
                                    <p class="text-grey-800 italic mr-2">Publié le {{ comment.comment.createdAt|date('d-m-Y') }}</p>
                                    <div class="w-2/5 mx-5 text-red-600">
                                        <a href="{{ path('user_can_ban_comment', {'idComment': comment.comment.id }) }}">
                                            <i class="fas fa-ban"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <hr class="mt-4 text-black mb-4">
                {% endfor %}
            </div>
        {% endif %}
        <div class="h-10 bg-blue2">
        </div>
    </section>
{% endblock %}

